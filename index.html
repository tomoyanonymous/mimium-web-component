<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mimium web component demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 0 20px;
            background: #0d1117;
            color: #c9d1d9;
        }
        h1 {
            color: #58a6ff;
        }
        p {
            color: #8b949e;
            line-height: 1.6;
        }
        code {
            background: #161b22;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .example {
            margin: 24px 0;
        }
        .example h2 {
            font-size: 1.1em;
            color: #c9d1d9;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <h1>mimium Web Component</h1>
    <p>
        The <code>&lt;mimium-editor&gt;</code> custom element provides a self-contained
        mimium language editor with syntax highlighting (Monaco Editor) and audio playback.
    </p>

    <div class="example">
        <h2>Sine wave oscillator</h2>
        <mimium-editor height="200" label="cascadeosc.mmm">
#stage(main)
let PI = 3.14159265359
fn phasor_shift(freq,phase_shift){
    (self + freq/samplerate + phase_shift)%1.0
}
fn sinwave(freq,phase){
    phasor_shift(freq,phase)*2.0*PI |> sin
}
fn osc(freq){
  sinwave(freq,0.0)
}
#stage(macro)
fn cascade (n,gen){
    if (n>0.0){
        let multiplier = 1.0-(1.0/(n*0.2)) |> lift_f
        `|rate| rate - ($gen)(rate/10) * rate * $multiplier  
                    |> $cascade(n - 1.0 ,gen)
    }else{
        `|rate| ($gen)(rate)
    }
}
#stage(main)
fn fbdelay(input,time,fb,mix){
    input*mix + (1.0-mix) * delay(40001.0,(input+self*fb),time)
}
fn dsp(){
    let time_r = osc(0.015) *1500
    let time_l = osc(0.01) *1000
    let f = 700
    let r =  (f |> cascade!(6,`osc))*0.2
    let l = fbdelay(r,20400+time_l,0.9,0.7)
    let r = fbdelay(r,20000+time_r,0.9,0.7)
    (r,r)
}</mimium-editor>
    </div>

    <div class="example">
        <h2>Using samplerate and now</h2>
        <mimium-editor height="150" theme="dark" label="sine.mmm">fn dsp(){
    sin(now * 440.0 * 6.2831853 / samplerate)
}</mimium-editor>
    </div>

    <script type="module" src="/src/index.ts"></script>
</body>
</html>